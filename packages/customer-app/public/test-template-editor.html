<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰ˆå‹ç·¨è¼¯å™¨æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
            text-decoration: none;
            display: inline-block;
        }
        .button:hover {
            background: #0056b3;
        }
        .info {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            color: #003d7a;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .status {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª ç‰ˆå‹ç·¨è¼¯å™¨æ¸¬è©¦å·¥å…·</h1>

        <div class="info">
            <strong>ğŸ“‹ æ¸¬è©¦æ­¥é©Ÿ</strong><br>
            1. é¦–å…ˆæª¢æŸ¥è³‡æ–™ç‹€æ…‹<br>
            2. å¦‚æœéœ€è¦ï¼Œé‡ç½®è³‡æ–™åº«<br>
            3. æ¸¬è©¦ç‰ˆå‹ç·¨è¼¯å™¨é€£çµ
        </div>

        <div class="test-section">
            <h3>ğŸ” è³‡æ–™æª¢æŸ¥</h3>
            <button class="button" onclick="checkData()">æª¢æŸ¥è³‡æ–™ç‹€æ…‹</button>
            <div id="dataStatus" class="status" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ—‘ï¸ è³‡æ–™åº«ç®¡ç†</h3>
            <a href="/database-reset.html" class="button">æ‰“é–‹è³‡æ–™åº«é‡ç½®å·¥å…·</a>
            <button class="button" onclick="resetDatabase()">å¿«é€Ÿé‡ç½®è³‡æ–™åº«</button>
        </div>

        <div class="test-section">
            <h3>ğŸ¨ ç‰ˆå‹ç·¨è¼¯å™¨æ¸¬è©¦</h3>
            <p>é»æ“Šä»¥ä¸‹é€£çµä¾†æ¸¬è©¦ç‰ˆå‹ç·¨è¼¯å™¨ï¼š</p>
            <div id="templateEditorLinks"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ  å°èˆª</h3>
            <a href="/" class="button">å›åˆ°é¦–é </a>
            <a href="/admin/templates" class="button">ç‰ˆå‹ç®¡ç†</a>
            <a href="/test-template-editor" class="button">Reactæ¸¬è©¦é é¢</a>
        </div>
    </div>

    <script>
        function log(message) {
            console.log(message);
        }

        function updateStatus(elementId, content) {
            const element = document.getElementById(elementId);
            element.innerHTML = content;
            element.style.display = 'block';
        }

        function checkData() {
            log('ğŸ” æª¢æŸ¥è³‡æ–™ç‹€æ…‹...');
            let statusHtml = '';

            try {
                // æª¢æŸ¥ç”¢å“è³‡æ–™
                const products = JSON.parse(localStorage.getItem('monkind_products') || '[]');
                statusHtml += `ğŸ“¦ ç”¢å“: ${products.length} å€‹<br>`;
                products.forEach((p, i) => {
                    statusHtml += `   - [${p.id}] ${p.title} (${p.category})<br>`;
                });

                // æª¢æŸ¥ç‰ˆå‹è³‡æ–™
                const templates = JSON.parse(localStorage.getItem('monkind_templates') || '[]');
                statusHtml += `<br>ğŸ¨ ç‰ˆå‹: ${templates.length} å€‹<br>`;
                templates.forEach((t, i) => {
                    statusHtml += `   - [${t.id}] ${t.name} (ç”¢å“ID: ${t.productId}, å…ƒç´ : ${t.elements?.length || 0})<br>`;
                });

                // æª¢æŸ¥å…¶ä»–è³‡æ–™
                const cart = JSON.parse(localStorage.getItem('shopping-cart') || '[]');
                statusHtml += `<br>ğŸ›’ è³¼ç‰©è»Š: ${cart.length} å€‹é …ç›®<br>`;

                // æª¢æŸ¥è‰ç¨¿
                let draftCount = 0;
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('draft_')) {
                        draftCount++;
                    }
                }
                statusHtml += `ğŸ“ è‰ç¨¿: ${draftCount} å€‹<br>`;

                statusHtml += '<br>âœ… è³‡æ–™æª¢æŸ¥å®Œæˆ';

                // ç”Ÿæˆç‰ˆå‹ç·¨è¼¯å™¨é€£çµ
                generateTemplateEditorLinks(products, templates);

            } catch (error) {
                statusHtml = `âŒ æª¢æŸ¥å¤±æ•—: ${error.message}`;
            }

            updateStatus('dataStatus', statusHtml);
        }

        function generateTemplateEditorLinks(products, templates) {
            let linksHtml = '';

            // æ–°å»ºç‰ˆå‹é€£çµ
            if (products.length > 0) {
                linksHtml += '<h4>ğŸ†• å»ºç«‹æ–°ç‰ˆå‹</h4>';
                products.forEach(product => {
                    const url = `/admin/templates/editor/new?productId=${product.id}`;
                    linksHtml += `<a href="${url}" class="button" target="_blank">æ–°å»ºç‰ˆå‹ - ${product.title}</a><br>`;
                });
            }

            // ç·¨è¼¯ç¾æœ‰ç‰ˆå‹é€£çµ
            if (templates.length > 0) {
                linksHtml += '<h4>âœï¸ ç·¨è¼¯ç¾æœ‰ç‰ˆå‹</h4>';
                templates.forEach(template => {
                    const url = `/admin/templates/editor/${template.id}`;
                    linksHtml += `<a href="${url}" class="button" target="_blank">ç·¨è¼¯ - ${template.name}</a><br>`;
                });
            }

            if (products.length === 0 && templates.length === 0) {
                linksHtml = '<p>âŒ æ²’æœ‰å¯ç”¨çš„ç”¢å“æˆ–ç‰ˆå‹ã€‚è«‹å…ˆé‡ç½®è³‡æ–™åº«ã€‚</p>';
            }

            document.getElementById('templateEditorLinks').innerHTML = linksHtml;
        }

        function resetDatabase() {
            if (!confirm('ç¢ºå®šè¦é‡ç½®è³‡æ–™åº«å—ï¼Ÿé€™æœƒæ¸…é™¤æ‰€æœ‰è³‡æ–™ï¼')) {
                return;
            }

            log('ğŸ”„ é–‹å§‹é‡ç½®è³‡æ–™åº«...');

            try {
                // æ¸…é™¤èˆŠè³‡æ–™
                const keysToDelete = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && (
                        key.startsWith('monkind_') ||
                        key.startsWith('shopping-cart') ||
                        key.startsWith('draft_') ||
                        key.startsWith('editingDesignData') ||
                        key.startsWith('editor_uploaded_images')
                    )) {
                        keysToDelete.push(key);
                    }
                }

                keysToDelete.forEach(key => {
                    localStorage.removeItem(key);
                });

                // è¨­å®šé è¨­è³‡æ–™
                const defaultProducts = [
                    {
                        id: 1,
                        title: "ç¶“å…¸ç™½è‰²é¦¬å…‹æ¯",
                        category: "mug",
                        price: 299,
                        imageUrl: "/images/mug-white.jpg",
                        description: "ç¶“å…¸ç™½è‰²é™¶ç“·é¦¬å…‹æ¯ï¼Œé©åˆå„ç¨®è¨­è¨ˆ",
                        isActive: true,
                        printArea: { width: 200, height: 150, offsetX: 100, offsetY: 75 }
                    },
                    {
                        id: 2,
                        title: "é»‘è‰²ç¶“å…¸é¦¬å…‹æ¯",
                        category: "mug",
                        price: 329,
                        imageUrl: "/images/mug-black.jpg",
                        description: "é»‘è‰²é™¶ç“·é¦¬å…‹æ¯ï¼Œæ‰“é€ å€‹æ€§é¢¨æ ¼",
                        isActive: true,
                        printArea: { width: 200, height: 150, offsetX: 100, offsetY: 75 }
                    },
                    {
                        id: 3,
                        title: "ç¶“å…¸ç™½è‰²Tæ¤",
                        category: "tshirt",
                        price: 399,
                        imageUrl: "/images/tshirt-white.jpg",
                        description: "100%ç´”æ£‰ç™½è‰²Tæ¤ï¼Œèˆ’é©é€æ°£",
                        isActive: true,
                        printArea: { width: 250, height: 300, offsetX: 125, offsetY: 100 }
                    }
                ];

                const defaultTemplates = [
                    {
                        id: 1,
                        name: "ç°¡ç´„æ–‡å­—ç¯„æœ¬",
                        description: "åŸºæœ¬æ–‡å­—è¨­è¨ˆç¯„æœ¬",
                        productId: 1,
                        productCategory: "mug",
                        elements: [{
                            id: "text-1",
                            type: "text",
                            content: "MonKind",
                            x: 200, y: 150,
                            fontSize: 32, color: "#000000",
                            fontFamily: "Arial", fontWeight: "bold", fontStyle: "normal"
                        }],
                        backgroundColor: "#ffffff",
                        thumbnail: null, isActive: true,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        name: "å¯æ„›åœ–æ¡ˆç¯„æœ¬",
                        description: "é©åˆå€‹äººä½¿ç”¨çš„å¯æ„›è¨­è¨ˆ",
                        productId: 1,
                        productCategory: "mug",
                        elements: [{
                            id: "text-1",
                            type: "text",
                            content: "Hello â˜•",
                            x: 200, y: 180,
                            fontSize: 24, color: "#8B4513",
                            fontFamily: "Arial", fontWeight: "normal", fontStyle: "normal"
                        }],
                        backgroundColor: "#FFF8DC",
                        thumbnail: null, isActive: true,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }
                ];

                const defaultUsers = [{
                    id: 1,
                    email: "admin@monkind.com",
                    password: "admin123",
                    name: "ç³»çµ±ç®¡ç†å“¡",
                    role: "admin",
                    isActive: true,
                    createdAt: new Date().toISOString()
                }];

                // å„²å­˜è³‡æ–™
                localStorage.setItem('monkind_products', JSON.stringify(defaultProducts));
                localStorage.setItem('monkind_templates', JSON.stringify(defaultTemplates));
                localStorage.setItem('monkind_users', JSON.stringify(defaultUsers));
                localStorage.setItem('shopping-cart', JSON.stringify([]));

                alert('âœ… è³‡æ–™åº«é‡ç½®å®Œæˆï¼è«‹é‡æ–°æª¢æŸ¥è³‡æ–™ã€‚');

                // è‡ªå‹•é‡æ–°æª¢æŸ¥è³‡æ–™
                setTimeout(checkData, 500);

            } catch (error) {
                alert(`âŒ é‡ç½®å¤±æ•—: ${error.message}`);
            }
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æª¢æŸ¥è³‡æ–™
        window.onload = function() {
            log('ğŸš€ ç‰ˆå‹ç·¨è¼¯å™¨æ¸¬è©¦å·¥å…·å·²è¼‰å…¥');
            checkData();
        };
    </script>
</body>
</html>