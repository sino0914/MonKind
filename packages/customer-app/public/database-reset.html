<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MonKind - è³‡æ–™åº«é‡ç½®å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
        }
        .button:hover {
            background: #0056b3;
        }
        .button.danger {
            background: #dc3545;
        }
        .button.danger:hover {
            background: #c82333;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—‘ï¸ MonKind è³‡æ–™åº«é‡ç½®å·¥å…·</h1>

        <div class="warning">
            <strong>âš ï¸ è­¦å‘Š</strong><br>
            é€™å€‹å·¥å…·æœƒæ¸…é™¤æ‰€æœ‰æœ¬åœ°è³‡æ–™ï¼ŒåŒ…æ‹¬ï¼š
            <ul>
                <li>ç”¢å“è³‡æ–™</li>
                <li>ç‰ˆå‹è³‡æ–™</li>
                <li>è³¼ç‰©è»Šè³‡æ–™</li>
                <li>è‰ç¨¿è³‡æ–™</li>
                <li>ç”¨æˆ¶è³‡æ–™</li>
            </ul>
            è«‹ç¢ºèªæ‚¨çœŸçš„éœ€è¦é‡ç½®è³‡æ–™åº«ã€‚
        </div>

        <div>
            <button class="button" onclick="checkDataIntegrity()">ğŸ” æª¢æŸ¥è³‡æ–™å®Œæ•´æ€§</button>
            <button class="button" onclick="exportBackup()">ğŸ’¾ åŒ¯å‡ºå‚™ä»½</button>
            <button class="button danger" onclick="clearAllData()">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰è³‡æ–™</button>
            <button class="button danger" onclick="resetToDefault()">ğŸ”„ é‡ç½®ç‚ºé è¨­è³‡æ–™</button>
        </div>

        <div class="log" id="log"></div>

        <div>
            <button class="button" onclick="goToMainApp()">ğŸ  è¿”å›ä¸»æ‡‰ç”¨</button>
        </div>
    </div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function checkDataIntegrity() {
            log('ğŸ” é–‹å§‹æª¢æŸ¥è³‡æ–™å®Œæ•´æ€§...');

            const issues = [];

            try {
                // æª¢æŸ¥ç”¢å“è³‡æ–™
                const products = JSON.parse(localStorage.getItem('monkind_products') || '[]');
                if (!Array.isArray(products)) {
                    issues.push('ç”¢å“è³‡æ–™æ ¼å¼éŒ¯èª¤');
                } else {
                    log(`   - æ‰¾åˆ° ${products.length} å€‹ç”¢å“`);
                }

                // æª¢æŸ¥ç‰ˆå‹è³‡æ–™
                const templates = JSON.parse(localStorage.getItem('monkind_templates') || '[]');
                if (!Array.isArray(templates)) {
                    issues.push('ç‰ˆå‹è³‡æ–™æ ¼å¼éŒ¯èª¤');
                } else {
                    log(`   - æ‰¾åˆ° ${templates.length} å€‹ç‰ˆå‹`);
                }

                // æª¢æŸ¥è³¼ç‰©è»Šè³‡æ–™
                const cart = JSON.parse(localStorage.getItem('shopping-cart') || '[]');
                if (!Array.isArray(cart)) {
                    issues.push('è³¼ç‰©è»Šè³‡æ–™æ ¼å¼éŒ¯èª¤');
                } else {
                    log(`   - è³¼ç‰©è»Šæœ‰ ${cart.length} å€‹é …ç›®`);
                }

                // æª¢æŸ¥è‰ç¨¿è³‡æ–™
                let draftCount = 0;
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('draft_')) {
                        draftCount++;
                    }
                }
                log(`   - æ‰¾åˆ° ${draftCount} å€‹è‰ç¨¿`);

                if (issues.length === 0) {
                    log('âœ… è³‡æ–™å®Œæ•´æ€§æª¢æŸ¥é€šé');
                } else {
                    log(`âŒ ç™¼ç¾ ${issues.length} å€‹å•é¡Œ: ${issues.join(', ')}`);
                }
            } catch (error) {
                log(`âŒ æª¢æŸ¥å¤±æ•—: ${error.message}`);
            }
        }

        function exportBackup() {
            log('ğŸ’¾ é–‹å§‹åŒ¯å‡ºå‚™ä»½...');

            try {
                const backup = {};
                const keysToBackup = [
                    'monkind_products',
                    'monkind_templates',
                    'monkind_users',
                    'shopping-cart'
                ];

                // åŒ¯å‡ºè‰ç¨¿
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('draft_')) {
                        backup[key] = localStorage.getItem(key);
                    }
                }

                // åŒ¯å‡ºå…¶ä»–è³‡æ–™
                keysToBackup.forEach(key => {
                    if (localStorage.getItem(key)) {
                        backup[key] = localStorage.getItem(key);
                    }
                });

                const dataStr = JSON.stringify(backup, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `monkind_backup_${new Date().getTime()}.json`;
                link.click();
                URL.revokeObjectURL(url);

                log('âœ… å‚™ä»½åŒ¯å‡ºå®Œæˆ');
            } catch (error) {
                log(`âŒ åŒ¯å‡ºå¤±æ•—: ${error.message}`);
            }
        }

        function clearAllData() {
            if (!confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰è³‡æ–™å—ï¼Ÿé€™å€‹å‹•ä½œç„¡æ³•å¾©åŸï¼')) {
                return;
            }

            log('ğŸ—‘ï¸ é–‹å§‹æ¸…é™¤æ‰€æœ‰è³‡æ–™...');

            try {
                const keysToDelete = [];

                // æ‰¾å‡ºæ‰€æœ‰ç›¸é—œçš„keys
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && (
                        key.startsWith('monkind_') ||
                        key.startsWith('shopping-cart') ||
                        key.startsWith('draft_') ||
                        key.startsWith('editingDesignData') ||
                        key.startsWith('editor_uploaded_images')
                    )) {
                        keysToDelete.push(key);
                    }
                }

                // åˆªé™¤æ‰¾åˆ°çš„keys
                keysToDelete.forEach(key => {
                    localStorage.removeItem(key);
                    log(`   - å·²åˆªé™¤: ${key}`);
                });

                log(`âœ… æ¸…é™¤å®Œæˆï¼Œå…±åˆªé™¤ ${keysToDelete.length} å€‹é …ç›®`);
            } catch (error) {
                log(`âŒ æ¸…é™¤å¤±æ•—: ${error.message}`);
            }
        }

        function resetToDefault() {
            if (!confirm('ç¢ºå®šè¦é‡ç½®ç‚ºé è¨­è³‡æ–™å—ï¼Ÿé€™æœƒæ¸…é™¤æ‰€æœ‰ç¾æœ‰è³‡æ–™ï¼')) {
                return;
            }

            log('ğŸ”„ é–‹å§‹é‡ç½®è³‡æ–™åº«...');

            try {
                // 1. æ¸…é™¤èˆŠè³‡æ–™
                clearAllData();

                // 2. è¨­å®šé è¨­ç”¢å“è³‡æ–™
                const defaultProducts = [
                    {
                        id: 1,
                        title: "ç¶“å…¸ç™½è‰²é¦¬å…‹æ¯",
                        category: "mug",
                        price: 299,
                        imageUrl: "/images/mug-white.jpg",
                        description: "ç¶“å…¸ç™½è‰²é™¶ç“·é¦¬å…‹æ¯ï¼Œé©åˆå„ç¨®è¨­è¨ˆ",
                        isActive: true,
                        printArea: { width: 200, height: 150, offsetX: 100, offsetY: 75 }
                    },
                    {
                        id: 2,
                        title: "é»‘è‰²ç¶“å…¸é¦¬å…‹æ¯",
                        category: "mug",
                        price: 329,
                        imageUrl: "/images/mug-black.jpg",
                        description: "é»‘è‰²é™¶ç“·é¦¬å…‹æ¯ï¼Œæ‰“é€ å€‹æ€§é¢¨æ ¼",
                        isActive: true,
                        printArea: { width: 200, height: 150, offsetX: 100, offsetY: 75 }
                    },
                    {
                        id: 3,
                        title: "ç¶“å…¸ç™½è‰²Tæ¤",
                        category: "tshirt",
                        price: 399,
                        imageUrl: "/images/tshirt-white.jpg",
                        description: "100%ç´”æ£‰ç™½è‰²Tæ¤ï¼Œèˆ’é©é€æ°£",
                        isActive: true,
                        printArea: { width: 250, height: 300, offsetX: 125, offsetY: 100 }
                    }
                ];

                // 3. è¨­å®šé è¨­ç‰ˆå‹è³‡æ–™
                const defaultTemplates = [
                    {
                        id: 1,
                        name: "ç°¡ç´„æ–‡å­—ç¯„æœ¬",
                        description: "åŸºæœ¬æ–‡å­—è¨­è¨ˆç¯„æœ¬",
                        productId: 1,
                        productCategory: "mug",
                        elements: [{
                            id: "text-1",
                            type: "text",
                            content: "MonKind",
                            x: 200, y: 150,
                            fontSize: 32, color: "#000000",
                            fontFamily: "Arial", fontWeight: "bold", fontStyle: "normal"
                        }],
                        backgroundColor: "#ffffff",
                        thumbnail: null, isActive: true,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        name: "å¯æ„›åœ–æ¡ˆç¯„æœ¬",
                        description: "é©åˆå€‹äººä½¿ç”¨çš„å¯æ„›è¨­è¨ˆ",
                        productId: 1,
                        productCategory: "mug",
                        elements: [{
                            id: "text-1",
                            type: "text",
                            content: "Hello â˜•",
                            x: 200, y: 180,
                            fontSize: 24, color: "#8B4513",
                            fontFamily: "Arial", fontWeight: "normal", fontStyle: "normal"
                        }],
                        backgroundColor: "#FFF8DC",
                        thumbnail: null, isActive: true,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }
                ];

                // 4. è¨­å®šé è¨­ç”¨æˆ¶è³‡æ–™
                const defaultUsers = [{
                    id: 1,
                    email: "admin@monkind.com",
                    password: "admin123",
                    name: "ç³»çµ±ç®¡ç†å“¡",
                    role: "admin",
                    isActive: true,
                    createdAt: new Date().toISOString()
                }];

                // 5. å„²å­˜æ‰€æœ‰é è¨­è³‡æ–™
                localStorage.setItem('monkind_products', JSON.stringify(defaultProducts));
                localStorage.setItem('monkind_templates', JSON.stringify(defaultTemplates));
                localStorage.setItem('monkind_users', JSON.stringify(defaultUsers));
                localStorage.setItem('shopping-cart', JSON.stringify([]));

                log('âœ… è³‡æ–™åº«é‡ç½®å®Œæˆ');
                log(`ğŸ“Š å·²è¨­å®š: ${defaultProducts.length}å€‹ç”¢å“, ${defaultTemplates.length}å€‹ç‰ˆå‹, ${defaultUsers.length}å€‹ç”¨æˆ¶`);
                log('ğŸ”„ æº–å‚™é‡æ–°è¼‰å…¥é é¢...');

                setTimeout(() => {
                    if (confirm('é‡ç½®å®Œæˆï¼æ˜¯å¦ç¾åœ¨é‡æ–°è¼‰å…¥é é¢ï¼Ÿ')) {
                        window.location.reload();
                    }
                }, 2000);

            } catch (error) {
                log(`âŒ é‡ç½®å¤±æ•—: ${error.message}`);
            }
        }

        function goToMainApp() {
            window.location.href = '/';
        }

        // é é¢è¼‰å…¥æ™‚é¡¯ç¤ºæ­¡è¿è¨Šæ¯
        window.onload = function() {
            log('ğŸš€ MonKind è³‡æ–™åº«é‡ç½®å·¥å…·å·²è¼‰å…¥');
            log('ğŸ’¡ é»æ“Šä¸Šæ–¹æŒ‰éˆ•ä¾†ç®¡ç†è³‡æ–™åº«');
        };
    </script>
</body>
</html>